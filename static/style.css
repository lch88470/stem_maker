:root{
  --bg: #0b0f19;
  --panel: #0f1423;
  --panel-2: #0b101d;
  --text: #e5e7eb;
  --muted: #92a0b7;
  --border: #1b2337;
  --accent: #8b5cf6;
  --danger: #ef4444;
  --good: #22d3ee;
  --led-red: #ff4d4d;
  --led-amber: #ffc94d;
  --led-green: #7CFF7A;
  --glow: rgba(139,92,246,0.55);
}
[data-theme="light"]{
  --bg: #f6f7fb;
  --panel: #ffffff;
  --panel-2: #f3f5fb;
  --text: #0c1222;
  --muted: #5c6a82;
  --border: #d9dfeb;
  --danger: #d11a2a;
  --good: #0ea5e9;
  --glow: rgba(139,92,246,0.25);
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family: "Inter", system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial;
  background: radial-gradient(1200px 600px at 30% -10%, #141a2c 0%, var(--bg) 60%), linear-gradient(180deg, var(--bg) 0%, var(--panel-2) 100%);
  color: var(--text);
  overflow-x: hidden;
}

/* Topbar / Transport */
.topbar{
  display:flex;align-items:center;justify-content:space-between;
  padding:12px 16px;border-bottom:1px solid var(--border);
  background: linear-gradient(180deg, var(--panel) 0%, var(--panel-2) 100%);
  position:sticky;top:0;z-index:50;
}
.brand{display:flex;align-items:center;gap:10px}
.brand .logo{
  width:28px;height:28px;border-radius:50%;
  display:inline-grid;place-items:center;font-weight:800;
  color:var(--accent);border:2px solid var(--accent); box-shadow:0 0 12px var(--glow) inset, 0 0 10px var(--glow);
}
.brand h1{font-size:16px;font-weight:700;letter-spacing:.3px}

.transport{display:flex;align-items:center;gap:8px}
.btn{
  border:1px solid var(--border);
  background:linear-gradient(180deg, var(--panel-2) 0%, var(--panel) 100%);
  color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer;
  transition:transform .08s ease, box-shadow .2s ease, border-color .2s ease;
}
.btn:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(0,0,0,.15)}
.btn.primary{background:linear-gradient(180deg, var(--accent) 0%, #5a36bf 100%);border-color:#3b2a7e;box-shadow:0 0 14px var(--glow)}
.btn.ghost{background:var(--panel-2);border-color:var(--border)}
.btn.danger{background:linear-gradient(180deg, #ff5757 0%, #b82020 100%);border-color:#6e1d1d}
.timecode{
  font-family:"IBM Plex Mono", monospace;min-width:106px;text-align:center;
  padding:8px 10px;border-radius:8px;border:1px solid var(--border);
  background:var(--panel-2);box-shadow:0 0 10px rgba(0,0,0,.1) inset;
  letter-spacing:1px
}

.switch{display:inline-flex;align-items:center;gap:8px}
.switch .slider{
  width:36px;height:20px;background:var(--panel-2);border-radius:999px;border:1px solid var(--border);display:inline-block;position:relative
}
.switch input{display:none}
.switch .slider::after{
  content:"";position:absolute;width:16px;height:16px;top:1px;left:1px;border-radius:50%;
  background:#8a8fa3;transition:transform .2s ease, background .2s ease;
}
.switch input:checked + .slider::after{transform:translateX(16px);background:var(--accent)}
.switch .label{font-size:12px;color:var(--muted)}
.accent{display:inline-flex;align-items:center;gap:8px;font-size:12px;color:var(--muted)}

/* Timeline */
.timeline{
  position:relative;border-bottom:1px solid var(--border);
  height:90px;background:linear-gradient(180deg,var(--panel) 0%,var(--panel-2) 100%);
  overflow:hidden;
}
.wave{width:100%;height:90px;display:block;opacity:.94}
.playhead{
  position:absolute;top:0;bottom:0;width:2px;background:var(--accent);
  box-shadow:0 0 12px var(--glow);transform:translateX(0)
}
.loop-shade{position:absolute;top:0;bottom:0;background:rgba(139,92,246,.15);pointer-events:none;display:none}
.loop-handle{
  position:absolute;top:0;bottom:0;width:10px;background:linear-gradient(180deg,#ccc2,#0006);
  border-left:1px solid #ffffff22;border-right:1px solid #00000066;cursor:ew-resize;display:none
}
.loop-handle.start{left:0}
.loop-handle.end{right:0}
.jog{
  position:absolute;right:12px;top:50%;transform:translateY(-50%);
  width:64px;height:64px;border-radius:50%;border:1px solid var(--border);background:radial-gradient(circle at 30% 30%, #fff1, #0008);
  box-shadow:inset 0 2px 8px rgba(0,0,0,.35);cursor:grab
}
.jog:active{cursor:grabbing}
.jog-center{
  position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
  width:10px;height:10px;border-radius:50%;background:var(--accent);box-shadow:0 0 12px var(--glow)
}

/* Layout */
.layout{display:grid;grid-template-columns:320px 1fr;gap:16px;padding:16px}
.sidebar .panel{
  background:linear-gradient(180deg,var(--panel) 0%, var(--panel-2) 100%);
  border:1px solid var(--border);border-radius:12px;padding:12px;margin-bottom:16px;
  box-shadow:inset 0 0 18px rgba(0,0,0,.08);
}
.panel-title{font-weight:700;color:var(--muted);margin-bottom:8px}
.session-list{display:flex;flex-direction:column;gap:8px;max-height:40vh;overflow:auto}
.session-item{
  padding:10px;border:1px solid var(--border);border-radius:10px;background:var(--panel-2);cursor:pointer;
  display:flex;align-items:center;justify-content:space-between;gap:8px
}
.session-item .title{font-size:13px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:70%}
.session-item .badge{font-size:10px;color:var(--muted)}
.session-item:hover{border-color:var(--accent);box-shadow:0 0 10px var(--glow) inset}

.snap-row{display:flex;gap:8px}
.snap-row input{flex:1;padding:8px;border-radius:8px;border:1px solid var(--border);background:var(--panel-2);color:var(--text)}

.aux{border:1px dashed var(--border);border-radius:10px;padding:8px;margin-bottom:10px;background:linear-gradient(180deg,var(--panel-2),var(--panel))}
.aux-title{font-size:12px;color:var(--muted);margin-bottom:6px}
.aux-row{display:flex;align-items:center;gap:10px;margin:6px 0}
.aux-row label{flex:0 0 70px;font-size:12px;color:var(--muted)}
.aux-row input[type="range"]{flex:1}

/* Mixer / Channel strips */
.mixer{
  display:flex;gap:12px;align-items:flex-end;overflow:auto;min-height:380px;padding:12px;
  background:linear-gradient(180deg,var(--panel-2) 0%, var(--panel) 100%);border:1px solid var(--border);border-radius:12px;
}
.hint{margin:auto;color:var(--muted);opacity:.8;text-align:center}
.channel{
  width:260px;min-width:260px;height:100%;display:flex;flex-direction:column;gap:10px;
  border:1px solid var(--border);border-radius:12px;background:linear-gradient(180deg,var(--panel) 0%, var(--panel-2) 100%);
  padding:10px;position:relative;overflow:hidden;
}
.channel .top{
  display:flex;align-items:center;justify-content:space-between;gap:8px
}
.name{
  font-weight:700;font-size:12px;letter-spacing:.5px;text-transform:uppercase;color:var(--muted);
  overflow:hidden;text-overflow:ellipsis;white-space:nowrap
}
.btn-xs{font-size:12px;padding:4px 8px;border-radius:8px}
.led-dot{width:10px;height:10px;border-radius:50%;box-shadow:0 0 8px rgba(0,0,0,.2) inset}
.led-dot.on.green{background:var(--led-green);box-shadow:0 0 12px #1aff1a}
.led-dot.on.red{background:var(--led-red);box-shadow:0 0 12px #f44}
.led-dot.off{background:#222}

.mini-wave{width:100%;height:46px;background:#0b1328;border-radius:6px;border:1px solid var(--border)}
.vu-vertical{height:120px;width:14px;background:#0b1328;border-radius:8px;border:1px solid var(--border);position:relative;overflow:hidden}
.vu-vertical .bar{position:absolute;bottom:0;left:0;right:0;background:linear-gradient(180deg, #28f7a0, #ffb84d, #ff6868);height:10%}
.vu-clip{position:absolute;top:4px;left:50%;transform:translateX(-50%);width:8px;height:8px;border-radius:50%;background:#300;border:1px solid #500}
.vu-clip.on{background:#f33;box-shadow:0 0 10px #f33}

.knob-bank{display:grid;grid-template-columns:repeat(4, 1fr);gap:8px;align-items:center;justify-items:center;padding:6px;border:1px dashed var(--border);border-radius:10px;background:linear-gradient(180deg,var(--panel-2),var(--panel))}
.knob-row-2{display:grid;grid-template-columns:repeat(3, 1fr);gap:8px;align-items:center;justify-items:center;margin-top:6px}

.knob{
  --size: 54px; --angle: 0deg; --arc: 0%;
  width:var(--size);height:var(--size);border-radius:50%;position:relative;
  background:
    conic-gradient(var(--accent) var(--arc), rgba(255,255,255,0.08) 0),
    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2), rgba(0,0,0,0.15) 60%);
  border:1px solid var(--border);
  box-shadow:inset 0 2px 8px rgba(0,0,0,.25);
  cursor:pointer;touch-action:none;
}
.knob .cap{position:absolute;left:50%;top:50%;width:4px;height:16px;background:var(--text);border-radius:2px;transform-origin:50% 100%;transform:translate(-50%, calc(-50% - 8px)) rotate(var(--angle))}
.knob .center{position:absolute;left:50%;top:50%;width:18px;height:18px;border-radius:50%;transform:translate(-50%, -50%);background:var(--panel-2);border:1px solid var(--border);box-shadow:inset 0 0 6px rgba(0,0,0,.25)}
.knob-label{font-size:10px;color:var(--muted);margin-top:4px;text-align:center}
.knob-value{font-size:11px;color:var(--text);font-family:"IBM Plex Mono", monospace;text-align:center}

.fader-wrap{position:relative;display:flex;gap:10px;align-items:flex-end;justify-content:space-between;min-height:160px}
.fader{-webkit-appearance:none;appearance:none;width:140px;height:28px;transform:rotate(-90deg);background:linear-gradient(90deg,var(--panel-2),var(--panel));border:1px solid var(--border);border-radius:10px;cursor:pointer}
.fader::-webkit-slider-thumb{-webkit-appearance:none;width:24px;height:24px;border-radius:6px;background:var(--accent);border:1px solid #3b2a7e;box-shadow:0 0 14px var(--glow)}
.fader::-moz-range-thumb{width:24px;height:24px;border:none;border-radius:6px;background:var(--accent)}
.db-scale{font-family:"IBM Plex Mono", monospace;font-size:10px;color:var(--muted);align-self:flex-end}

.channel .footer{display:flex;justify-content:space-between;align-items:center;gap:8px;margin-top:6px}
.dl{text-decoration:none;color:var(--text);font-size:12px;padding:4px 8px;border-radius:8px;border:1px solid var(--border);background:var(--panel-2)}
.dl:hover{border-color:var(--accent);box-shadow:0 0 10px var(--glow) inset}

/* Search Drawer (Rack) */
.search-drawer{position:fixed;inset:0;background:rgba(2,5,10,.65);backdrop-filter:blur(8px);display:flex;flex-direction:column;padding:16px;z-index:100;overflow:auto}
[data-theme="light"] .search-drawer{background:rgba(255,255,255,.6)}
.search-drawer.hidden{display:none}
.search-header{display:flex;gap:10px;align-items:center;margin-bottom:12px}
.search-header input{flex:1;padding:12px;border-radius:10px;border:1px solid var(--border);background:var(--panel-2);color:var(--text)}
.rack-grid{display:grid;gap:14px;grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}
.rack-card{border:1px solid var(--border);border-radius:12px;background:linear-gradient(180deg,var(--panel-2),var(--panel));padding:12px;display:flex;gap:12px}
.rack-card img{width:120px;height:80px;object-fit:cover;border-radius:8px;border:1px solid var(--border);flex:0 0 auto}
.rack-card .meta{flex:1;display:flex;flex-direction:column;gap:6px;min-width:0}
.rack-card .title{font-weight:600;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.rack-card .actions{display:flex;gap:8px;flex-wrap:wrap}

/* Toast */
.toast{position:fixed;bottom:16px;left:50%;transform:translateX(-50%);background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:10px 14px;color:var(--text);box-shadow:0 8px 28px rgba(0,0,0,.15);opacity:0;pointer-events:none;transition:opacity .2s ease}
.toast.show{opacity:1;pointer-events:auto}

/* Processing Rack Modal */
.rack-modal{position:fixed;inset:0;display:grid;place-items:center;background:rgba(2,5,10,.75);backdrop-filter:blur(6px)}
[data-theme="light"] .rack-modal{background:rgba(255,255,255,.7)}
.rack-modal.hidden{display:none}
.rack{width:min(720px, 92vw);background:linear-gradient(180deg,var(--panel),var(--panel-2));border:1px solid var(--border);border-radius:14px;box-shadow:0 12px 50px rgba(0,0,0,.2);overflow:hidden}
.rack-header{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid var(--border)}
.rack-title{font-weight:700;letter-spacing:.6px}
.led-row{display:flex;gap:8px}.led{width:10px;height:10px;border-radius:50%;opacity:.85}.led.red{background:var(--led-red)}.led.amber{background:var(--led-amber)}.led.green{background:var(--led-green)}
.screws{display:flex;gap:8px}.screw{width:10px;height:10px;border-radius:50%;background:var(--panel-2);border:1px solid var(--border);box-shadow:inset 0 0 8px rgba(0,0,0,.08)}
.rack-body{padding:18px;display:flex;flex-direction:column;gap:16px}
.progress-tube{position:relative;height:24px;border-radius:18px;border:1px solid var(--border);overflow:hidden;background:linear-gradient(180deg,var(--panel-2),var(--panel))}
.progress-glow{position:absolute;inset:0;background:radial-gradient(60% 60% at 20% 50%, var(--glow), transparent 60%);animation:glide 2s linear infinite;opacity:.6;pointer-events:none}
@keyframes glide{0%{transform:translateX(-40%)}100%{transform:translateX(120%)}}
.progress-fill{position:absolute;top:0;bottom:0;left:0;background:linear-gradient(90deg, #18328a, var(--accent));box-shadow:0 0 20px var(--glow)}
.progress-cap.left,.progress-cap.right{position:absolute;top:0;bottom:0;width:10px;background:linear-gradient(180deg,#334,#112);opacity:.3}
.progress-cap.left{left:0;border-right:1px solid rgba(255,255,255,.04)}.progress-cap.right{right:0;border-left:1px solid rgba(255,255,255,.04)}
.status-steps{display:flex;gap:12px;flex-wrap:wrap}
.step{display:flex;align-items:center;gap:6px;color:var(--muted);font-size:13px}
.step .dot{width:8px;height:8px;border-radius:50%;background:#223}
.step.active .dot{background:var(--led-amber);box-shadow:0 0 8px #fbd24d}
.step.done .dot{background:var(--led-green);box-shadow:0 0 8px #7CFF7A}
.rack-marquee{font-family:"IBM Plex Mono", monospace;color:var(--muted);opacity:.9;white-space:nowrap;overflow:hidden;border-top:1px dashed var(--border);padding-top:10px}

/* Hotkeys overlay */
.hotkeys{position:fixed;inset:0;background:rgba(0,0,0,.5);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:120}
.hotkeys.hidden{display:none}
.hotkeys-inner{width:min(520px,95vw);background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:16px}
.hk-title{font-weight:700;margin-bottom:8px}
.hk-list{display:grid;gap:6px;margin-bottom:10px}

/* Responsive */
@media (max-width: 1080px){
  .layout{grid-template-columns:1fr}
  .sidebar{order:2}
  .mixer{order:1}
}