<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Stem Studio Console</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=IBM+Plex+Mono:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <!-- Processing Rack Modal -->
  <div id="processingModal" class="rack-modal hidden" aria-hidden="true" role="dialog" aria-label="Demucs processing">
    <div class="rack">
      <div class="rack-header">
        <div class="led-row">
          <span class="led red"></span>
          <span class="led amber"></span>
          <span class="led green"></span>
        </div>
        <div class="rack-title">Demucs Processor</div>
        <div class="screws">
          <span class="screw"></span><span class="screw"></span>
        </div>
      </div>
      <div class="rack-body">
        <div class="progress-tube">
          <div class="progress-glow"></div>
          <div class="progress-fill" id="processFill" style="width: 0%"></div>
          <div class="progress-cap left"></div>
          <div class="progress-cap right"></div>
        </div>
        <div class="status-steps">
          <div class="step" id="step-fetch"><span class="dot"></span>Fetching audio</div>
          <div class="step" id="step-sep"><span class="dot"></span>Separating stems</div>
          <div class="step" id="step-final"><span class="dot"></span>Finalizing</div>
        </div>
        <div class="rack-marquee" id="rackMarquee">Working‚Ä¶ high fidelity split in progress</div>
      </div>
    </div>
  </div>

  <!-- Keyboard help -->
  <div id="hotkeys" class="hotkeys hidden" aria-hidden="true">
    <div class="hotkeys-inner">
      <div class="hk-title">Keyboard Shortcuts</div>
      <ul class="hk-list">
        <li>Space: Play/Pause</li>
        <li>L: Toggle Loop</li>
        <li>‚Üê/‚Üí: Seek</li>
        <li>1‚Äì9: Focus Channel</li>
        <li>M/S: Mute/Solo focused channel</li>
        <li>?: Toggle this help</li>
      </ul>
      <button id="closeHotkeys" class="btn ghost">Close</button>
    </div>
  </div>

  <!-- Topbar / Transport -->
  <header class="topbar">
    <div class="brand">
      <span class="logo">‚óé</span>
      <h1>Stem Studio Console</h1>
    </div>

    <div class="transport" role="group" aria-label="Transport">
      <button id="btnStop" class="btn ghost" aria-label="Stop">‚èπ</button>
      <button id="btnPlay" class="btn primary" aria-label="Play/Pause">‚ñ∂</button>
      <button id="btnLoop" class="btn ghost" aria-pressed="false" aria-label="Loop">üîÅ</button>
      <button id="btnRecord" class="btn danger" aria-pressed="false" aria-label="Record Mix">‚è∫</button>
      <div class="timecode" aria-live="polite"><span id="timeDisplay">00:00.0</span></div>
    </div>

    <div class="top-controls">
      <label class="switch">
        <input id="uiSoundToggle" type="checkbox" checked>
        <span class="slider"></span>
        <span class="label">UI sound</span>
      </label>

      <label class="switch">
        <input id="themeToggle" type="checkbox" aria-label="Toggle Light Theme">
        <span class="slider"></span>
        <span class="label">Light</span>
      </label>

      <label class="accent">
        <span>Accent</span>
        <input id="accentPicker" type="color" value="#8b5cf6" aria-label="Accent color">
      </label>

      <button id="openSearch" class="btn" aria-label="Search YouTube">Search</button>
      <a id="zipAll" class="btn ghost" href="#" download aria-label="Download all stems as ZIP">ZIP</a>
      <button id="btnHotkeys" class="btn ghost" aria-label="Hotkeys">?</button>
    </div>
  </header>

  <!-- Timeline with loop region + jog -->
  <div class="timeline" aria-label="Timeline">
    <canvas id="waveCanvas" class="wave"></canvas>
    <div class="loop-shade" id="loopShade"></div>
    <div class="loop-handle start" id="loopStart" draggable="false" aria-label="Loop Start"></div>
    <div class="loop-handle end" id="loopEnd" draggable="false" aria-label="Loop End"></div>
    <div class="playhead" id="playhead" role="slider" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"></div>
    <div class="jog" id="jog" aria-label="Jog wheel">
      <div class="jog-center"></div>
    </div>
  </div>

  <main class="layout">
    <!-- Sidebar: Session, Snapshots, Master + Aux Rack -->
    <aside class="sidebar">
      <div class="panel">
        <div class="panel-title">Session Browser</div>
        <div id="libraryList" class="session-list"></div>
      </div>

      <div class="panel">
        <div class="panel-title">Snapshots</div>
        <div class="snap-row">
          <input id="snapName" type="text" placeholder="Name this mix‚Ä¶" />
          <button id="saveSnap" class="btn ghost">Save</button>
        </div>
        <div id="snapList" class="session-list"></div>
      </div>

      <div class="panel">
        <div class="panel-title">Master</div>
        <canvas id="masterVU" class="vu"></canvas>
        <canvas id="spectrum" class="spectrum"></canvas>
        <div class="master-controls">
          <label>Master</label>
          <input id="masterGain" type="range" min="0" max="1.5" step="0.01" value="1" aria-label="Master gain">
        </div>
      </div>

      <div class="panel">
        <div class="panel-title">Aux Rack</div>
        <div class="aux">
          <div class="aux-title">Aux A: Reverb</div>
          <div class="aux-row">
            <label>Return</label>
            <input id="auxAReturn" type="range" min="0" max="1.2" step="0.01" value="0.25">
          </div>
          <div class="aux-row">
            <label>Size</label>
            <input id="auxASize" type="range" min="0.2" max="3.0" step="0.01" value="1.6">
          </div>
        </div>
        <div class="aux">
          <div class="aux-title">Aux B: Delay</div>
          <div class="aux-row">
            <label>Return</label>
            <input id="auxBReturn" type="range" min="0" max="1.2" step="0.01" value="0.2">
          </div>
          <div class="aux-row">
            <label>Time</label>
            <input id="auxBTime" type="range" min="0.05" max="0.8" step="0.01" value="0.35">
          </div>
          <div class="aux-row">
            <label>Feedback</label>
            <input id="auxBFeedback" type="range" min="0" max="0.9" step="0.01" value="0.35">
          </div>
          <div class="aux-row">
            <label>Hi-Cut</label>
            <input id="auxBHiCut" type="range" min="1000" max="12000" step="50" value="7000">
          </div>
        </div>
      </div>
    </aside>

    <!-- Mixer -->
    <section class="mixer" id="mixer">
      <div id="noSong" class="hint">
        Search a track, split it, and start mixing like an engineer.
      </div>
    </section>
  </main>

  <!-- Search Drawer -->
  <div id="searchDrawer" class="search-drawer hidden" aria-hidden="true">
    <div class="search-header">
      <input id="query" type="text" placeholder="Search YouTube for a song‚Ä¶" aria-label="Search query">
      <button id="searchBtn" class="btn primary">Search</button>
      <button id="closeSearch" class="btn ghost">Close</button>
    </div>
    <div id="results" class="rack-grid"></div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script src="/static/app.js"></script>
</body>
</html>